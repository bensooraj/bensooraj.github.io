(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[27],{6313:function(e,s,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/2-up-and-running-with-kafka-on-aws-eks-using-strimzi",function(){return n(5006)}])},1290:function(e,s,n){"use strict";var a=n(5893),l=n(5711),r=n.n(l),c=function(e){var s=e.src,n=e.alt,l=e.width,c=e.height;return(0,a.jsx)("img",{className:r().carousel,src:s,alt:n,width:l,height:c})};s.Z=c,c.defaultProps={width:"100%",height:"100%"}},5006:function(e,s,n){"use strict";n.r(s),n.d(s,{default:function(){return i}});var a=n(5893),l=n(1151),r=n(1290),c=function(){return(0,a.jsx)("sup",{children:(0,a.jsx)("a",{href:"#contents",children:"[back to top \u2191]"})})};function t(e){var s=Object.assign({h1:"h1",h2:"h2",ol:"ol",li:"li",a:"a",p:"p",code:"code",pre:"pre",span:"span",strong:"strong",blockquote:"blockquote",em:"em",hr:"hr"},(0,l.ah)(),e.components);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(s.h1,{children:"Up And Running With Kafka On AWS EKS Using Strimzi"}),"\n",(0,a.jsxs)(s.h2,{children:["Contents ",(0,a.jsx)("a",{id:"contents"})]}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"#configure-the-aws-cli",children:"Configure the AWS CLI"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"#create-the-eks-cluster",children:"Create the EKS cluster"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"#enter-k8s",children:"Enter Kubernetes"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"#install-and-configure-helm",children:"Install and configure Helm"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"#install-strimzi-kafka-operator",children:"Install the Strimzi Kafka Operator"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"#deploy-kaka-cluster",children:"Deploying the Kafka cluster"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"#analysis",children:"Analysis"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"#create-topics",children:"Create topics"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"#test-kafka-cluster",children:"Test the Kafka cluster with Node.js clients"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.a,{href:"#clean-up",children:"Clean up!"})}),"\n"]}),"\n",(0,a.jsx)(s.p,{children:"Let's get right into it, then!"}),"\n",(0,a.jsxs)(s.p,{children:["We will be using ",(0,a.jsx)(s.a,{href:"https://eksctl.io/",children:(0,a.jsx)(s.code,{children:"eksctl"})}),", the official CLI for Amazon EKS, to spin up our K8s cluster."]}),"\n",(0,a.jsxs)(s.h2,{children:["Configure the AWS CLI ",(0,a.jsx)("a",{name:"configure-the-aws-cli"})," ",(0,a.jsx)(c,{})]}),"\n",(0,a.jsxs)(s.p,{children:["Ensure that the AWS CLI is ",(0,a.jsx)(s.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-configure.html",children:"configured"}),". To view your configuration:"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsxs)(s.code,{className:"hljs language-go",children:["$ aws configure list\n      Name                    Value             Type    Location\n      ----                    -----             ----    --------\n   profile                <not set>             None    None\naccess_key     ****************",(0,a.jsx)(s.span,{className:"hljs-number",children:"7"}),"ONG shared-credentials-file    \nsecret_key     ****************lbQg shared-credentials-file    \n    region               ap-south",(0,a.jsx)(s.span,{className:"hljs-number",children:"-1"}),"      config-file    ~/.aws/config\n"]})}),"\n",(0,a.jsxs)(s.p,{children:["Note: The aws CLI config and credentials details are usually stored at ",(0,a.jsx)(s.code,{children:"~/.aws/config"})," and ",(0,a.jsx)(s.code,{children:"~/.aws/credentials"})," respectively."]}),"\n",(0,a.jsxs)(s.h2,{children:["Create the EKS cluster ",(0,a.jsx)("a",{name:"create-the-eks-cluster"})," ",(0,a.jsx)(c,{})]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsxs)(s.code,{className:"hljs language-arduino",children:["\n$ eksctl create cluster --name=kafka-eks-cluster --nodes=",(0,a.jsx)(s.span,{className:"hljs-number",children:"4"})," --region=ap-south",(0,a.jsx)(s.span,{className:"hljs-number",children:"-1"}),"\n\n[\u2139]  ",(0,a.jsx)(s.span,{className:"hljs-keyword",children:"using"})," region ap-south",(0,a.jsx)(s.span,{className:"hljs-number",children:"-1"}),"\n[\u2139]  setting availability zones to [ap-south",(0,a.jsx)(s.span,{className:"hljs-number",children:"-1b"})," ap-south",(0,a.jsx)(s.span,{className:"hljs-number",children:"-1"}),"a ap-south",(0,a.jsx)(s.span,{className:"hljs-number",children:"-1"}),"c]\n[\u2139]  subnets ",(0,a.jsx)(s.span,{className:"hljs-keyword",children:"for"})," ap-south",(0,a.jsx)(s.span,{className:"hljs-number",children:"-1b"})," - ",(0,a.jsx)(s.span,{className:"hljs-keyword",children:"public"}),":",(0,a.jsx)(s.span,{className:"hljs-number",children:"192.168"}),(0,a.jsx)(s.span,{className:"hljs-number",children:".0"}),(0,a.jsx)(s.span,{className:"hljs-number",children:".0"}),"/",(0,a.jsx)(s.span,{className:"hljs-number",children:"19"})," ",(0,a.jsx)(s.span,{className:"hljs-keyword",children:"private"}),":",(0,a.jsx)(s.span,{className:"hljs-number",children:"192.168"}),(0,a.jsx)(s.span,{className:"hljs-number",children:".96"}),(0,a.jsx)(s.span,{className:"hljs-number",children:".0"}),"/",(0,a.jsx)(s.span,{className:"hljs-number",children:"19"}),"\n[\u2139]  subnets ",(0,a.jsx)(s.span,{className:"hljs-keyword",children:"for"})," ap-south",(0,a.jsx)(s.span,{className:"hljs-number",children:"-1"}),"a - ",(0,a.jsx)(s.span,{className:"hljs-keyword",children:"public"}),":",(0,a.jsx)(s.span,{className:"hljs-number",children:"192.168"}),(0,a.jsx)(s.span,{className:"hljs-number",children:".32"}),(0,a.jsx)(s.span,{className:"hljs-number",children:".0"}),"/",(0,a.jsx)(s.span,{className:"hljs-number",children:"19"})," ",(0,a.jsx)(s.span,{className:"hljs-keyword",children:"private"}),":",(0,a.jsx)(s.span,{className:"hljs-number",children:"192.168"}),(0,a.jsx)(s.span,{className:"hljs-number",children:".128"}),(0,a.jsx)(s.span,{className:"hljs-number",children:".0"}),"/",(0,a.jsx)(s.span,{className:"hljs-number",children:"19"}),"\n[\u2139]  subnets ",(0,a.jsx)(s.span,{className:"hljs-keyword",children:"for"})," ap-south",(0,a.jsx)(s.span,{className:"hljs-number",children:"-1"}),"c - ",(0,a.jsx)(s.span,{className:"hljs-keyword",children:"public"}),":",(0,a.jsx)(s.span,{className:"hljs-number",children:"192.168"}),(0,a.jsx)(s.span,{className:"hljs-number",children:".64"}),(0,a.jsx)(s.span,{className:"hljs-number",children:".0"}),"/",(0,a.jsx)(s.span,{className:"hljs-number",children:"19"})," ",(0,a.jsx)(s.span,{className:"hljs-keyword",children:"private"}),":",(0,a.jsx)(s.span,{className:"hljs-number",children:"192.168"}),(0,a.jsx)(s.span,{className:"hljs-number",children:".160"}),(0,a.jsx)(s.span,{className:"hljs-number",children:".0"}),"/",(0,a.jsx)(s.span,{className:"hljs-number",children:"19"}),"\n[\u2139]  nodegroup ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"ng-9f3cbfc7"'})," will use ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"ami-09c3eb35bb3be46a4"'})," [AmazonLinux2/",(0,a.jsx)(s.span,{className:"hljs-number",children:"1.12"}),"]\n[\u2139]  creating EKS cluster ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"kafka-eks-cluster"'})," in ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"ap-south-1"'})," region\n[\u2139]  will create ",(0,a.jsx)(s.span,{className:"hljs-number",children:"2"})," separate CloudFormation stacks ",(0,a.jsx)(s.span,{className:"hljs-keyword",children:"for"})," cluster itself ",(0,a.jsx)(s.span,{className:"hljs-keyword",children:"and"})," the initial nodegroup\n[\u2139]  ",(0,a.jsx)(s.span,{className:"hljs-keyword",children:"if"})," you encounter any issues, check CloudFormation console ",(0,a.jsx)(s.span,{className:"hljs-keyword",children:"or"})," ",(0,a.jsx)(s.span,{className:"hljs-keyword",children:"try"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:"'eksctl utils describe-stacks --region=ap-south-1 --name=kafka-eks-cluster'"}),"\n[\u2139]  ",(0,a.jsx)(s.span,{className:"hljs-number",children:"2"})," sequential tasks: { create cluster control plane ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"kafka-eks-cluster"'}),", create nodegroup ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"ng-9f3cbfc7"'})," }\n[\u2139]  building cluster stack ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"eksctl-kafka-eks-cluster-cluster"'}),"\n[\u2139]  deploying stack ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"eksctl-kafka-eks-cluster-cluster"'}),"\n[\u2139]  building nodegroup stack ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"eksctl-kafka-eks-cluster-nodegroup-ng-9f3cbfc7"'}),"\n[\u2139]  --nodes-min=",(0,a.jsx)(s.span,{className:"hljs-number",children:"4"})," was set automatically ",(0,a.jsx)(s.span,{className:"hljs-keyword",children:"for"})," nodegroup ng",(0,a.jsx)(s.span,{className:"hljs-number",children:"-9f"}),"3cbfc7\n[\u2139]  --nodes-max=",(0,a.jsx)(s.span,{className:"hljs-number",children:"4"})," was set automatically ",(0,a.jsx)(s.span,{className:"hljs-keyword",children:"for"})," nodegroup ng",(0,a.jsx)(s.span,{className:"hljs-number",children:"-9f"}),"3cbfc7\n[\u2139]  deploying stack ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"eksctl-kafka-eks-cluster-nodegroup-ng-9f3cbfc7"'}),"\n[\u2714]  all EKS cluster resource ",(0,a.jsx)(s.span,{className:"hljs-keyword",children:"for"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"kafka-eks-cluster"'})," had been created\n[\u2714]  saved kubeconfig as ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"/Users/Bensooraj/.kube/config"'}),"\n[\u2139]  adding role ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"arn:aws:iam::account_numer:role/eksctl-kafka-eks-cluster-nodegrou-NodeInstanceRole-IG63RKPE03YQ"'})," to auth ConfigMap\n[\u2139]  nodegroup ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"ng-9f3cbfc7"'})," has ",(0,a.jsx)(s.span,{className:"hljs-number",children:"0"})," ",(0,a.jsx)(s.span,{className:"hljs-built_in",children:"node"}),"(s)\n[\u2139]  waiting ",(0,a.jsx)(s.span,{className:"hljs-keyword",children:"for"})," at least ",(0,a.jsx)(s.span,{className:"hljs-number",children:"4"})," ",(0,a.jsx)(s.span,{className:"hljs-built_in",children:"node"}),"(s) to become ready in ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"ng-9f3cbfc7"'}),"\n[\u2139]  nodegroup ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"ng-9f3cbfc7"'})," has ",(0,a.jsx)(s.span,{className:"hljs-number",children:"4"})," ",(0,a.jsx)(s.span,{className:"hljs-built_in",children:"node"}),"(s)\n[\u2139]  node ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"ip-192-168-25-34.ap-south-1.compute.internal"'})," is ready\n[\u2139]  node ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"ip-192-168-50-249.ap-south-1.compute.internal"'})," is ready\n[\u2139]  node ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"ip-192-168-62-231.ap-south-1.compute.internal"'})," is ready\n[\u2139]  node ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"ip-192-168-69-95.ap-south-1.compute.internal"'})," is ready\n[\u2139]  kubectl command should work with ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"/Users/Bensooraj/.kube/config"'}),", ",(0,a.jsx)(s.span,{className:"hljs-keyword",children:"try"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:"'kubectl get nodes'"}),"\n[\u2714]  EKS cluster ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"kafka-eks-cluster"'})," in ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"ap-south-1"'})," region is ready\n\n"]})}),"\n",(0,a.jsxs)(s.p,{children:["A k8s cluster by the name ",(0,a.jsx)(s.strong,{children:"kafka-eks-cluster"})," will be created with 4 nodes (instance type: ",(0,a.jsx)(s.a,{href:"https://aws.amazon.com/ec2/instance-types/",children:"m5.large"}),") in the Mumbai region (ap-south-1). You can view these in the AWS Console UI as well,"]}),"\n",(0,a.jsx)(s.p,{children:"EKS:"}),"\n",(0,a.jsx)(r.Z,{src:"/2/1_xamksw0rnxsxjohb8zkh.png",alt:"AWS EKS UI"}),"\n",(0,a.jsx)(s.p,{children:"CloudFormation UI:"}),"\n",(0,a.jsx)(r.Z,{src:"/2/2_8gj6kw97f6bxkm6u9a44.png",alt:"Cloudformation UI"}),"\n",(0,a.jsxs)(s.p,{children:["Also, after the cluster is created, the appropriate kubernetes configuration will be added to your kubeconfig file (defaults to ",(0,a.jsx)(s.code,{children:"~/.kube/config"}),"). The path to the kubeconfig file can be overridden using the ",(0,a.jsx)(s.code,{children:"--kubeconfig"})," flag."]}),"\n",(0,a.jsxs)(s.h2,{children:["Enter Kubernetes ",(0,a.jsx)("a",{name:"enter-k8s"})," ",(0,a.jsx)(c,{})]}),"\n",(0,a.jsxs)(s.p,{children:["Fetching all k8s controllers lists the default ",(0,a.jsx)(s.code,{children:"kubernetes"})," service. This confirms that ",(0,a.jsx)(s.code,{children:"kubectl"})," is properly configured to point to the cluster that we just created."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"hljs language-sh",children:"$ kubectl get all\nNAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE\nservice/kubernetes   ClusterIP   10.100.0.1   <none>        443/TCP   19m\n"})}),"\n",(0,a.jsxs)(s.h2,{children:["Install and configure Helm ",(0,a.jsx)("a",{name:"install-and-configure-helm"})," ",(0,a.jsx)(c,{})]}),"\n",(0,a.jsxs)(s.blockquote,{children:["\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.a,{href:"https://helm.sh",children:"Helm"})," is a package manager and application management tool for Kubernetes that packages multiple Kubernetes resources into a single logical deployment unit called Chart."]}),"\n"]}),"\n",(0,a.jsxs)(s.p,{children:["I use ",(0,a.jsx)(s.em,{children:"Homebrew"}),", so the installation was pretty straightforward: ",(0,a.jsx)(s.code,{children:"brew install kubernetes-helm"}),"."]}),"\n",(0,a.jsxs)(s.p,{children:["Alternatively, to install ",(0,a.jsx)(s.code,{children:"helm"}),", run the following:"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsxs)(s.code,{className:"hljs language-sh",children:["$ ",(0,a.jsx)(s.span,{className:"hljs-built_in",children:"cd"})," ~/eks-kafka-strimzi\n\n$ curl https://raw.githubusercontent.com/kubernetes/helm/master/scripts/get > get_helm.sh\n\n$ ",(0,a.jsx)(s.span,{className:"hljs-built_in",children:"chmod"})," +x get_helm.sh\n\n$ ./get_helm.sh\n"]})}),"\n",(0,a.jsxs)(s.p,{children:["Read through their ",(0,a.jsx)(s.a,{href:"https://helm.sh/docs/using_helm/#installing-helm",children:"installation guide"}),", if you are looking for more options."]}),"\n",(0,a.jsx)(s.p,{children:(0,a.jsxs)(s.strong,{children:["Do not run ",(0,a.jsx)(s.code,{children:"helm init"})," yet."]})}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.code,{children:"Helm"})," relies on a service called ",(0,a.jsx)(s.strong,{children:(0,a.jsx)(s.code,{children:"tiller"})})," that requires special permission on the kubernetes cluster, so we need to build a ",(0,a.jsx)(s.strong,{children:(0,a.jsx)(s.code,{children:"Service Account"})})," (RBAC access) for ",(0,a.jsx)(s.strong,{children:(0,a.jsx)(s.code,{children:"tiller"})})," to use."]}),"\n",(0,a.jsxs)(s.p,{children:["The ",(0,a.jsx)(s.code,{children:"rbac.yaml"})," file would look like the following:"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsxs)(s.code,{className:"hljs language-yaml",children:[(0,a.jsx)(s.span,{className:"hljs-meta",children:"---"}),"\n",(0,a.jsx)(s.span,{className:"hljs-attr",children:"apiVersion:"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:"v1"}),"\n",(0,a.jsx)(s.span,{className:"hljs-attr",children:"kind:"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:"ServiceAccount"}),"\n",(0,a.jsx)(s.span,{className:"hljs-attr",children:"metadata:"}),"\n  ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"name:"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:"tiller"}),"\n  ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"namespace:"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:"kube-system"}),"\n",(0,a.jsx)(s.span,{className:"hljs-meta",children:"---"}),"\n",(0,a.jsx)(s.span,{className:"hljs-attr",children:"apiVersion:"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:"rbac.authorization.k8s.io/v1beta1"}),"\n",(0,a.jsx)(s.span,{className:"hljs-attr",children:"kind:"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:"ClusterRoleBinding"}),"\n",(0,a.jsx)(s.span,{className:"hljs-attr",children:"metadata:"}),"\n  ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"name:"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:"tiller"}),"\n",(0,a.jsx)(s.span,{className:"hljs-attr",children:"roleRef:"}),"\n  ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"apiGroup:"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:"rbac.authorization.k8s.io"}),"\n  ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"kind:"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:"ClusterRole"}),"\n  ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"name:"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:"cluster-admin"}),"\n",(0,a.jsx)(s.span,{className:"hljs-attr",children:"subjects:"}),"\n  ",(0,a.jsx)(s.span,{className:"hljs-bullet",children:"-"})," ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"kind:"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:"ServiceAccount"}),"\n    ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"name:"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:"tiller"}),"\n    ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"namespace:"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:"kube-system"}),"\n"]})}),"\n",(0,a.jsxs)(s.p,{children:["Apply this to the ",(0,a.jsx)(s.code,{children:"kafka-eks-cluster"})," cluster:"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsxs)(s.code,{className:"hljs language-sh",children:["$ kubectl apply -f rbac.yaml\nserviceaccount/tiller created\nclusterrolebinding.rbac.authorization.k8s.io/tiller created\n\n",(0,a.jsx)(s.span,{className:"hljs-comment",children:"# Verify (listing only the relevant ones)"}),"\n$ kubectl get sa,clusterrolebindings --namespace=kube-system\nNAME                        SECRETS   AGE\n.\nserviceaccount/tiller       1         5m22s\n.\n\nNAME                                                                                                AGE\n.\nclusterrolebinding.rbac.authorization.k8s.io/tiller                                                 5m23s\n.\n"]})}),"\n",(0,a.jsxs)(s.p,{children:["Now, run ",(0,a.jsx)(s.strong,{children:(0,a.jsx)(s.code,{children:"helm init"})})," using the service account we setup. This will install tiller into the cluster which gives it access to manage resources in your cluster."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsxs)(s.code,{className:"hljs language-sh",children:["$ helm init --service-account=tiller\n\n",(0,a.jsx)(s.span,{className:"hljs-variable",children:"$HELM_HOME"})," has been configured at /Users/Bensooraj/.helm.\n\nTiller (the Helm server-side component) has been installed into your Kubernetes Cluster.\n\nPlease note: by default, Tiller is deployed with an insecure ",(0,a.jsx)(s.span,{className:"hljs-string",children:"'allow unauthenticated users'"})," policy.\n\nTo prevent this, run `helm init` with the --tiller-tls-verify flag.\n\nFor more information on securing your installation see: https://docs.helm.sh/using_helm/",(0,a.jsx)(s.span,{className:"hljs-comment",children:"#securing-your-helm-installation"}),"\n"]})}),"\n",(0,a.jsxs)(s.h2,{children:["Install the Strimzi Kafka Operator ",(0,a.jsx)("a",{name:"install-strimzi-kafka-operator"})," ",(0,a.jsx)(c,{})]}),"\n",(0,a.jsx)(s.p,{children:"Add the Strimzi repository and install the Strimzi Helm Chart:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsxs)(s.code,{className:"hljs language-sh",children:[(0,a.jsx)(s.span,{className:"hljs-comment",children:"# Add the repo"}),"\n$ helm repo add strimzi http://strimzi.io/charts/\n",(0,a.jsx)(s.span,{className:"hljs-string",children:'"strimzi"'})," has been added to your repositories\n\n",(0,a.jsx)(s.span,{className:"hljs-comment",children:"# Search for all Strimzi  charts"}),"\n$ helm search strim\nNAME                          \tCHART VERSION\tAPP VERSION\tDESCRIPTION                \nstrimzi/strimzi-kafka-operator\t0.14.0       \t0.14.0     \tStrimzi: Kafka as a Service\n\n",(0,a.jsx)(s.span,{className:"hljs-comment",children:"# Install the kafka operator"}),"\n$ helm install strimzi/strimzi-kafka-operator\nNAME:   bulging-gnat\nLAST DEPLOYED: Wed Oct  2 15:23:45 2019\nNAMESPACE: default\nSTATUS: DEPLOYED\n\nRESOURCES:\n==> v1/ClusterRole\nNAME                                 AGE\nstrimzi-cluster-operator-global      0s\nstrimzi-cluster-operator-namespaced  0s\nstrimzi-entity-operator              0s\nstrimzi-kafka-broker                 0s\nstrimzi-topic-operator               0s\n\n==> v1/ClusterRoleBinding\nNAME                                              AGE\nstrimzi-cluster-operator                          0s\nstrimzi-cluster-operator-kafka-broker-delegation  0s\n\n==> v1/Deployment\nNAME                      READY  UP-TO-DATE  AVAILABLE  AGE\nstrimzi-cluster-operator  0/1    1           0          0s\n\n==> v1/Pod(related)\nNAME                                       READY  STATUS             RESTARTS  AGE\nstrimzi-cluster-operator-6667fbc5f8-cqvdv  0/1    ContainerCreating  0         0s\n\n==> v1/RoleBinding\nNAME                                                 AGE\nstrimzi-cluster-operator                             0s\nstrimzi-cluster-operator-entity-operator-delegation  0s\nstrimzi-cluster-operator-topic-operator-delegation   0s\n\n==> v1/ServiceAccount\nNAME                      SECRETS  AGE\nstrimzi-cluster-operator  1        0s\n\n==> v1beta1/CustomResourceDefinition\nNAME                                AGE\nkafkabridges.kafka.strimzi.io       0s\nkafkaconnects.kafka.strimzi.io      0s\nkafkaconnects2is.kafka.strimzi.io   0s\nkafkamirrormakers.kafka.strimzi.io  0s\nkafkas.kafka.strimzi.io             1s\nkafkatopics.kafka.strimzi.io        1s\nkafkausers.kafka.strimzi.io         1s\n\nNOTES:\nThank you ",(0,a.jsx)(s.span,{className:"hljs-keyword",children:"for"})," installing strimzi-kafka-operator-0.14.0\n\nTo create a Kafka cluster refer to the following documentation.\n\nhttps://strimzi.io/docs/0.14.0/",(0,a.jsx)(s.span,{className:"hljs-comment",children:"#kafka-cluster-str"}),"\n"]})}),"\n",(0,a.jsx)(s.p,{children:"List all the kubernetes objects created again:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"hljs language-sh",children:"$ kubectl get all\nNAME                                            READY   STATUS    RESTARTS   AGE\npod/strimzi-cluster-operator-6667fbc5f8-cqvdv   1/1     Running   0          9m25s\n\nNAME                 TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)   AGE\nservice/kubernetes   ClusterIP   10.100.0.1   <none>        443/TCP   90m\n\nNAME                                       DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\ndeployment.apps/strimzi-cluster-operator   1         1         1            1           9m25s\n\nNAME                                                  DESIRED   CURRENT   READY   AGE\nreplicaset.apps/strimzi-cluster-operator-6667fbc5f8   1         1         1       9m26s\n"})}),"\n",(0,a.jsxs)(s.h2,{children:["Deploying the Kafka cluster ",(0,a.jsx)("a",{name:"deploy-kaka-cluster"})," ",(0,a.jsx)(c,{})]}),"\n",(0,a.jsxs)(s.p,{children:["We will now create a Kafka cluster with 3 brokers. The YAML file (",(0,a.jsx)(s.code,{children:"kafka-cluster.Kafka.yaml"}),") for creating the Kafka cluster would like the following:"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsxs)(s.code,{className:"hljs language-yaml",children:[(0,a.jsx)(s.span,{className:"hljs-attr",children:"apiVersion:"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:"kafka.strimzi.io/v1beta1"}),"\n",(0,a.jsx)(s.span,{className:"hljs-attr",children:"kind:"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:"Kafka"}),"\n",(0,a.jsx)(s.span,{className:"hljs-attr",children:"metadata:"}),"\n  ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"name:"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:"kafka-cluster"}),"\n",(0,a.jsx)(s.span,{className:"hljs-attr",children:"spec:"}),"\n  ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"kafka:"}),"\n    ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"version:"})," ",(0,a.jsx)(s.span,{className:"hljs-number",children:"2.3"}),(0,a.jsx)(s.span,{className:"hljs-number",children:".0"})," ",(0,a.jsx)(s.span,{className:"hljs-comment",children:"# Kafka version"}),"\n    ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"replicas:"})," ",(0,a.jsx)(s.span,{className:"hljs-number",children:"3"})," ",(0,a.jsx)(s.span,{className:"hljs-comment",children:"# Replicas specifies the number of broker nodes."}),"\n    ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"listeners:"})," ",(0,a.jsx)(s.span,{className:"hljs-comment",children:"# Listeners configure how clients connect to the Kafka cluster"}),"\n      ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"plain:"})," {} ",(0,a.jsx)(s.span,{className:"hljs-comment",children:"# 9092"}),"\n      ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"tls:"})," {} ",(0,a.jsx)(s.span,{className:"hljs-comment",children:"# 9093"}),"\n    ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"config:"}),"\n      ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"offsets.topic.replication.factor:"})," ",(0,a.jsx)(s.span,{className:"hljs-number",children:"3"}),"\n      ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"transaction.state.log.replication.factor:"})," ",(0,a.jsx)(s.span,{className:"hljs-number",children:"3"}),"\n      ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"transaction.state.log.min.isr:"})," ",(0,a.jsx)(s.span,{className:"hljs-number",children:"2"}),"\n      ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"log.message.format.version:"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"2.3"'}),"\n      ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"delete.topic.enable:"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"true"'}),"\n    ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"storage:"}),"\n      ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"type:"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:"persistent-claim"}),"\n      ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"size:"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:"10Gi"}),"\n      ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"deleteClaim:"})," ",(0,a.jsx)(s.span,{className:"hljs-literal",children:"false"}),"\n  ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"zookeeper:"}),"\n    ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"replicas:"})," ",(0,a.jsx)(s.span,{className:"hljs-number",children:"3"}),"\n    ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"storage:"}),"\n      ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"type:"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:"persistent-claim"})," ",(0,a.jsx)(s.span,{className:"hljs-comment",children:"# Persistent storage backed by AWS EBS"}),"\n      ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"size:"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:"10Gi"}),"\n      ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"deleteClaim:"})," ",(0,a.jsx)(s.span,{className:"hljs-literal",children:"false"}),"\n  ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"entityOperator:"}),"\n    ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"topicOperator:"})," {} ",(0,a.jsx)(s.span,{className:"hljs-comment",children:"# Operator for topic administration"}),"\n    ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"userOperator:"})," {}\n\n"]})}),"\n",(0,a.jsx)(s.p,{children:"Apply the above YAML file:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"hljs language-sh",children:"$ kubectl apply -f kafka-cluster.Kafka.yaml\n"})}),"\n",(0,a.jsxs)(s.h2,{children:["Analysis ",(0,a.jsx)("a",{name:"analysis"})," ",(0,a.jsx)(c,{})]}),"\n",(0,a.jsxs)(s.p,{children:["This is where things get interesting. We will now analyse ",(0,a.jsx)(s.strong,{children:"some"})," of the k8s resources which the ",(0,a.jsx)(s.code,{children:"strimzi kafka operator"})," has created for us under the hood."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"hljs language-sh",children:"$ kubectl get statefulsets.apps,pod,deployments,svc\nNAME                                       DESIRED   CURRENT   AGE\nstatefulset.apps/kafka-cluster-kafka       3         3         78m\nstatefulset.apps/kafka-cluster-zookeeper   3         3         79m\n\nNAME                                                 READY   STATUS    RESTARTS   AGE\npod/kafka-cluster-entity-operator-54cb77fd9d-9zbcx   3/3     Running   0          77m\npod/kafka-cluster-kafka-0                            2/2     Running   0          78m\npod/kafka-cluster-kafka-1                            2/2     Running   0          78m\npod/kafka-cluster-kafka-2                            2/2     Running   0          78m\npod/kafka-cluster-zookeeper-0                        2/2     Running   0          79m\npod/kafka-cluster-zookeeper-1                        2/2     Running   0          79m\npod/kafka-cluster-zookeeper-2                        2/2     Running   0          79m\npod/strimzi-cluster-operator-6667fbc5f8-cqvdv        1/1     Running   0          172m\n\nNAME                                                  DESIRED   CURRENT   UP-TO-DATE   AVAILABLE   AGE\ndeployment.extensions/kafka-cluster-entity-operator   1         1         1            1           77m\ndeployment.extensions/strimzi-cluster-operator        1         1         1            1           172m\n\nNAME                                     TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)                      AGE\nservice/kafka-cluster-kafka-bootstrap    ClusterIP   10.100.177.177   <none>        9091/TCP,9092/TCP,9093/TCP   78m\nservice/kafka-cluster-kafka-brokers      ClusterIP   None             <none>        9091/TCP,9092/TCP,9093/TCP   78m\nservice/kafka-cluster-zookeeper-client   ClusterIP   10.100.199.128   <none>        2181/TCP                     79m\nservice/kafka-cluster-zookeeper-nodes    ClusterIP   None             <none>        2181/TCP,2888/TCP,3888/TCP   79m\nservice/kubernetes                       ClusterIP   10.100.0.1       <none>        443/TCP                      4h13m\n"})}),"\n",(0,a.jsx)(s.p,{children:"Points to note:"}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsxs)(s.li,{children:["The StatefulSet ",(0,a.jsx)(s.code,{children:"kafka-cluster-zookeeper"})," has created 3 pods - ",(0,a.jsx)(s.code,{children:"kafka-cluster-zookeeper-0"}),", ",(0,a.jsx)(s.code,{children:"kafka-cluster-zookeeper-1"})," and ",(0,a.jsx)(s.code,{children:"kafka-cluster-zookeeper-2"}),". The headless service ",(0,a.jsx)(s.code,{children:"kafka-cluster-zookeeper-nodes"})," facilitates network identity of these 3 pods (the 3 Zookeeper nodes)."]}),"\n",(0,a.jsxs)(s.li,{children:["The StatefulSet ",(0,a.jsx)(s.code,{children:"kafka-cluster-kafka"})," has created 3 pods - ",(0,a.jsx)(s.code,{children:"kafka-cluster-kafka-0"}),", ",(0,a.jsx)(s.code,{children:"kafka-cluster-kafka-1"})," and ",(0,a.jsx)(s.code,{children:"kafka-cluster-kafka-2"}),". The headless service ",(0,a.jsx)(s.code,{children:"kafka-cluster-kafka-brokers"})," facilitates network identity of these 3 pods (the 3 Kafka brokers)."]}),"\n"]}),"\n",(0,a.jsx)(s.p,{children:"Persistent volumes are dynamically provisioned:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"hljs language-sh",children:"$ kubectl get pv,pvc\nNAME                                                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                                    STORAGECLASS   REASON   AGE\npersistentvolume/pvc-7ff2909f-e507-11e9-91df-0a1e73fdd786   10Gi       RWO            Delete           Bound    default/data-kafka-cluster-zookeeper-1   gp2                     11h\npersistentvolume/pvc-7ff290c4-e507-11e9-91df-0a1e73fdd786   10Gi       RWO            Delete           Bound    default/data-kafka-cluster-zookeeper-2   gp2                     11h\npersistentvolume/pvc-7ffd1d22-e507-11e9-a775-029ce0835b96   10Gi       RWO            Delete           Bound    default/data-kafka-cluster-zookeeper-0   gp2                     11h\npersistentvolume/pvc-a5997b77-e507-11e9-91df-0a1e73fdd786   10Gi       RWO            Delete           Bound    default/data-kafka-cluster-kafka-0       gp2                     11h\npersistentvolume/pvc-a599e52b-e507-11e9-91df-0a1e73fdd786   10Gi       RWO            Delete           Bound    default/data-kafka-cluster-kafka-1       gp2                     11h\npersistentvolume/pvc-a59c6cd2-e507-11e9-91df-0a1e73fdd786   10Gi       RWO            Delete           Bound    default/data-kafka-cluster-kafka-2       gp2                     11h\n\nNAME                                                   STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE\npersistentvolumeclaim/data-kafka-cluster-kafka-0       Bound    pvc-a5997b77-e507-11e9-91df-0a1e73fdd786   10Gi       RWO            gp2            11h\npersistentvolumeclaim/data-kafka-cluster-kafka-1       Bound    pvc-a599e52b-e507-11e9-91df-0a1e73fdd786   10Gi       RWO            gp2            11h\npersistentvolumeclaim/data-kafka-cluster-kafka-2       Bound    pvc-a59c6cd2-e507-11e9-91df-0a1e73fdd786   10Gi       RWO            gp2            11h\npersistentvolumeclaim/data-kafka-cluster-zookeeper-0   Bound    pvc-7ffd1d22-e507-11e9-a775-029ce0835b96   10Gi       RWO            gp2            11h\npersistentvolumeclaim/data-kafka-cluster-zookeeper-1   Bound    pvc-7ff2909f-e507-11e9-91df-0a1e73fdd786   10Gi       RWO            gp2            11h\npersistentvolumeclaim/data-kafka-cluster-zookeeper-2   Bound    pvc-7ff290c4-e507-11e9-91df-0a1e73fdd786   10Gi       RWO            gp2            11h\n"})}),"\n",(0,a.jsx)(s.p,{children:"You can view the provisioned AWS EBS volumes in the UI as well:"}),"\n",(0,a.jsx)(r.Z,{src:"/2/3_zys2wmubcb42glzzp23m.png",alt:"EBS UI"}),"\n",(0,a.jsxs)(s.h2,{children:["Create topics ",(0,a.jsx)("a",{name:"create-topics"})," ",(0,a.jsx)(c,{})]}),"\n",(0,a.jsxs)(s.p,{children:["Before we get started with clients we need to create a ",(0,a.jsx)(s.strong,{children:"topic"})," (with 3 partitions and a replication factor of 3), over which our ",(0,a.jsx)(s.code,{children:"producer"})," and the ",(0,a.jsx)(s.code,{children:"consumer"})," and produce messages and consume messages on respectively."]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsxs)(s.code,{className:"hljs language-yaml",children:[(0,a.jsx)(s.span,{className:"hljs-attr",children:"apiVersion:"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:"kafka.strimzi.io/v1beta1"}),"\n",(0,a.jsx)(s.span,{className:"hljs-attr",children:"kind:"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:"KafkaTopic"}),"\n",(0,a.jsx)(s.span,{className:"hljs-attr",children:"metadata:"}),"\n  ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"name:"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:"test-topic"}),"\n  ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"labels:"}),"\n    ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"strimzi.io/cluster:"})," ",(0,a.jsx)(s.span,{className:"hljs-string",children:"kafka-cluster"}),"\n",(0,a.jsx)(s.span,{className:"hljs-attr",children:"spec:"}),"\n  ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"partitions:"})," ",(0,a.jsx)(s.span,{className:"hljs-number",children:"3"}),"\n  ",(0,a.jsx)(s.span,{className:"hljs-attr",children:"replicas:"})," ",(0,a.jsx)(s.span,{className:"hljs-number",children:"3"}),"\n"]})}),"\n",(0,a.jsx)(s.p,{children:"Apply the YAML to the k8s cluster:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"hljs language-sh",children:"$ kubectl apply -f create-topics.yaml\nkafkatopic.kafka.strimzi.io/test-topic created\n"})}),"\n",(0,a.jsxs)(s.h2,{children:["Test the Kafka cluster with Node.js clients ",(0,a.jsx)("a",{name:"test-kafka-cluster"})," ",(0,a.jsx)(c,{})]}),"\n",(0,a.jsxs)(s.p,{children:["The multi-broker Kafka cluster that we deployed is backed by ",(0,a.jsx)(s.code,{children:"statefulset"}),"s and their corresponding headless ",(0,a.jsx)(s.code,{children:"service"}),"s."]}),"\n",(0,a.jsxs)(s.p,{children:["Since each Pod (Kafka broker) now has a network identity, clients can connect to the Kafka brokers via a combination of the pod name and service name: ",(0,a.jsx)(s.code,{children:"$(podname).$(governing service domain)"}),". In our case, these would be the following URLs:"]}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.code,{children:"kafka-cluster-kafka-0.kafka-cluster-kafka-brokers"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.code,{children:"kafka-cluster-kafka-1.kafka-cluster-kafka-brokers"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.code,{children:"kafka-cluster-kafka-2.kafka-cluster-kafka-brokers"})}),"\n"]}),"\n",(0,a.jsxs)(s.p,{children:[(0,a.jsx)(s.strong,{children:"Note"}),":"]}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsxs)(s.li,{children:["If the Kafka cluster is deployed in a different namespace, you will have to expand it a little further: ",(0,a.jsx)(s.code,{children:"$(podname).$(service name).$(namespace).svc.cluster.local"}),"."]}),"\n",(0,a.jsxs)(s.li,{children:["Alternatively, the clients can connect to the Kafka cluster using the Service ",(0,a.jsx)(s.code,{children:"kafka-cluster-kafka-bootstrap:9092"})," as well. It distributes the connection over the three broker specific endpoints I have listed above. As I no longer keep track of the individual broker endpoints, this method plays out well when I have to scale up or down the number of brokers in the Kafka cluster."]}),"\n"]}),"\n",(0,a.jsxs)(s.p,{children:["First, clone this repo: ",(0,a.jsx)(s.a,{href:"https://github.com/bensooraj/strimzi-kafka-aws-eks",children:"strimzi-kafka-aws-eks"})]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsxs)(s.code,{className:"hljs language-sh",children:[(0,a.jsx)(s.span,{className:"hljs-comment",children:"# Create the configmap, which contains details such as the broker DNS names, topic name and consumer group ID"}),"\n$ kubectl apply -f ",(0,a.jsx)(s.span,{className:"hljs-built_in",children:"test"}),"/k8s/config.yaml\nconfigmap/kafka-client-config created\n\n",(0,a.jsx)(s.span,{className:"hljs-comment",children:"# Create the producer deployment"}),"\n$ kubectl apply -f ",(0,a.jsx)(s.span,{className:"hljs-built_in",children:"test"}),"/k8s/producer.Deployment.yaml\ndeployment.apps/node-test-producer created\n\n",(0,a.jsx)(s.span,{className:"hljs-comment",children:"# Expose the producer deployment via a service of type LoadBalancer (backed by the AWS Elastic Load Balancer). This just makes it easy for me to curl from postman"}),"\n$ kubectl apply -f ",(0,a.jsx)(s.span,{className:"hljs-built_in",children:"test"}),"/k8s/producer.Service.yaml\nservice/node-test-producer created\n\n",(0,a.jsx)(s.span,{className:"hljs-comment",children:"# Finally, create the consumer deployment"}),"\n$ kubectl apply -f ",(0,a.jsx)(s.span,{className:"hljs-built_in",children:"test"}),"/k8s/consumer.Deployment.yaml\ndeployment.apps/node-test-consumer created\n\n"]})}),"\n",(0,a.jsxs)(s.p,{children:["If you list the producer service that we created, you would notice a ",(0,a.jsx)(s.code,{children:"URL"})," under EXTERNAL-IP:"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"hljs language-sh",children:"$ kubectl get svc\nNAME                             TYPE           CLUSTER-IP       EXTERNAL-IP                                                                PORT(S)                      AGE\n.\n.\nnode-test-producer               LoadBalancer   10.100.145.203   ac5f3d0d1e55a11e9a775029ce0835b9-2040242746.ap-south-1.elb.amazonaws.com   80:31231/TCP                 55m\n\n"})}),"\n",(0,a.jsxs)(s.p,{children:["The URL ",(0,a.jsx)(s.code,{children:"ac5f3d0d1e55a11e9a775029ce0835b9-2040242746.ap-south-1.elb.amazonaws.com"})," is an ",(0,a.jsx)(s.code,{children:"AWS ELB"})," backed public endpoint which we will be querying for producing messages to the Kafka cluster."]}),"\n",(0,a.jsxs)(s.p,{children:["Also, you can see that there is 1 producer and 3 consumers (one for each partition of the topic ",(0,a.jsx)(s.code,{children:"test-topic"}),"):"]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsx)(s.code,{className:"hljs language-sh",children:"$ kubectl get pod\nNAME                                             READY   STATUS    RESTARTS   AGE\nnode-test-consumer-96b44cbcb-gs2km               1/1     Running   0          125m\nnode-test-consumer-96b44cbcb-ptvjd               1/1     Running   0          125m\nnode-test-consumer-96b44cbcb-xk75j               1/1     Running   0          125m\nnode-test-producer-846d9c5986-vcsf2              1/1     Running   0          125m\n"})}),"\n",(0,a.jsx)(s.p,{children:"The producer app basically exposes 3 URLs:"}),"\n",(0,a.jsxs)(s.ol,{children:["\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.code,{children:"/kafka-test/green/:message"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.code,{children:"/kafka-test/blue/:message"})}),"\n",(0,a.jsx)(s.li,{children:(0,a.jsx)(s.code,{children:"/kafka-test/cyan/:message"})}),"\n"]}),"\n",(0,a.jsxs)(s.p,{children:["Where ",(0,a.jsx)(s.code,{children:":message"})," can be any valid string. Each of these URLs produce a ",(0,a.jsx)(s.strong,{children:"message"})," along with the ",(0,a.jsx)(s.strong,{children:"colour"})," information to the topic ",(0,a.jsx)(s.code,{children:"test-topic"}),"."]}),"\n",(0,a.jsxs)(s.p,{children:["The consumer group (the 3 consumer pods that we spin-up) listening for any incoming messages from the topic ",(0,a.jsx)(s.code,{children:"test-topic"}),", then receives these messages and prints them on to the console according to the colour instruction."]}),"\n",(0,a.jsxs)(s.p,{children:["I ",(0,a.jsx)(s.code,{children:"curl"})," each URL 3 times. From the following GIF you can see how message consumption is distributed across the 3 consumers in a ",(0,a.jsx)(s.code,{children:"round-robin"})," manner:"]}),"\n",(0,a.jsx)(r.Z,{src:"/2/4_a3b19iryt7pxff3z8ust.gif",alt:"Producer and Consumer Visualisation"}),"\n",(0,a.jsxs)(s.h2,{children:["Clean Up! ",(0,a.jsx)("a",{name:"clean-up"})," ",(0,a.jsx)(c,{})]}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsxs)(s.code,{className:"hljs language-sh",children:["\n",(0,a.jsx)(s.span,{className:"hljs-comment",children:"# Delete the test producer and consumer apps:"}),"\n$ kubectl delete -f ",(0,a.jsx)(s.span,{className:"hljs-built_in",children:"test"}),"/k8s/\nconfigmap ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"kafka-client-config"'})," deleted\ndeployment.apps ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"node-test-consumer"'})," deleted\ndeployment.apps ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"node-test-producer"'})," deleted\nservice ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"node-test-producer"'})," deleted\n\n",(0,a.jsx)(s.span,{className:"hljs-comment",children:"# Delete the Kafka cluster"}),"\n$ kubectl delete kafka kafka-cluster\nkafka.kafka.strimzi.io ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"kafka-cluster"'})," deleted\n\n",(0,a.jsx)(s.span,{className:"hljs-comment",children:"# Delete the Strimzi cluster operator"}),"\n$ kubectl delete deployments. strimzi-cluster-operator\ndeployment.extensions ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"strimzi-cluster-operator"'})," deleted\n\n",(0,a.jsx)(s.span,{className:"hljs-comment",children:"# Manually delete the persistent volumes"}),"\n",(0,a.jsx)(s.span,{className:"hljs-comment",children:"# Kafka"}),"\n$ kubectl delete pvc data-kafka-cluster-kafka-0\n$ kubectl delete pvc data-kafka-cluster-kafka-1\n$ kubectl delete pvc data-kafka-cluster-kafka-2\n",(0,a.jsx)(s.span,{className:"hljs-comment",children:"# Zookeeper"}),"\n$ kubectl delete pvc data-kafka-cluster-zookeeper-0\n$ kubectl delete pvc data-kafka-cluster-zookeeper-1\n$ kubectl delete pvc data-kafka-cluster-zookeeper-2\n"]})}),"\n",(0,a.jsx)(s.p,{children:"Finally, delete the EKS cluster:"}),"\n",(0,a.jsx)(s.pre,{children:(0,a.jsxs)(s.code,{className:"hljs language-sh",children:["$ eksctl delete cluster kafka-eks-cluster\n[\u2139]  using region ap-south-1\n[\u2139]  deleting EKS cluster ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"kafka-eks-cluster"'}),"\n[\u2714]  kubeconfig has been updated\n[\u2139]  2 sequential tasks: { delete nodegroup ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"ng-9f3cbfc7"'}),", delete cluster control plane ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"kafka-eks-cluster"'})," [async] }\n[\u2139]  will delete stack ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"eksctl-kafka-eks-cluster-nodegroup-ng-9f3cbfc7"'}),"\n[\u2139]  waiting ",(0,a.jsx)(s.span,{className:"hljs-keyword",children:"for"})," stack ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"eksctl-kafka-eks-cluster-nodegroup-ng-9f3cbfc7"'})," to get deleted\n[\u2139]  will delete stack ",(0,a.jsx)(s.span,{className:"hljs-string",children:'"eksctl-kafka-eks-cluster-cluster"'}),"\n[\u2714]  all cluster resources were deleted\n"]})}),"\n",(0,a.jsx)(s.p,{children:"Hope this helped!"}),"\n",(0,a.jsx)(s.hr,{}),"\n",(0,a.jsxs)(s.p,{children:["Note: ",(0,a.jsx)(s.em,{children:"This is not a tutorial per se, instead, this is me recording my observations as I setup a Kafka cluster for the first time on a Kubernetes platform using Strimzi."})]})]})}var i=function(e){var s=void 0===e?{}:e,n=Object.assign({},(0,l.ah)(),s.components).wrapper;return n?(0,a.jsx)(n,Object.assign({},s,{children:(0,a.jsx)(t,s)})):t(s)}},5711:function(e){e.exports={carousel:"MDImage_carousel__N8hEe"}}},function(e){e.O(0,[774,888,179],(function(){return s=6313,e(e.s=s);var s}));var s=e.O();_N_E=s}]);